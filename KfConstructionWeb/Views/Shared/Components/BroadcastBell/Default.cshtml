@model KfConstructionWeb.ViewComponents.BroadcastBellViewModel

@if (Model.UnreadCount > 0)
{
    <li class="nav-item dropdown me-2">
        <a class="nav-link dropdown-toggle position-relative" href="#" id="broadcastDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-bell"></i>
            <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                @Model.UnreadCount
                <span class="visually-hidden">unread messages</span>
            </span>
        </a>
        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="broadcastDropdown" style="min-width: 320px;">
            <li class="dropdown-header">Unread messages</li>
            @foreach (var m in Model.UnreadTop)
            {
                <li class="px-3 py-2">
                    <div class="d-flex justify-content-between align-items-start">
                        <div class="me-2" style="max-width: 220px;">
                            <div class="fw-semibold">@m.Subject</div>
                            <div class="small text-muted">@m.SentAt.ToLocalTime().ToString("g")</div>
                        </div>
                        <form asp-area="Admin" asp-controller="Broadcast" asp-action="MarkRead" method="post" class="ms-2">
                            @Html.AntiForgeryToken()
                            <input type="hidden" name="id" value="@m.Id" />
                            <button type="submit" class="btn btn-sm btn-outline-success" title="Mark as read">
                                <i class="bi bi-check2"></i>
                            </button>
                        </form>
                    </div>
                </li>
            }
            <li><hr class="dropdown-divider" /></li>
            <li>
                <a class="dropdown-item text-center" asp-area="Admin" asp-controller="Broadcast" asp-action="Index">
                    View all messages
                </a>
            </li>
        </ul>
    </li>
}
