@model IEnumerable<KfConstructionWeb.Models.Receipt>
@{
    ViewData["Title"] = "Print Receipts";
    Layout = null; // No layout for print view
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        @@media print {
            .no-print {
                display: none !important;
            }
            body {
                font-size: 12pt;
            }
            table {
                page-break-inside: auto;
            }
            tr {
                page-break-inside: avoid;
                page-break-after: auto;
            }
        }
        
        .receipt-header {
            border-bottom: 3px solid #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
        }
        
        .summary-box {
            background-color: #f8f9fa;
            border: 2px solid #dee2e6;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        table {
            width: 100%;
        }
        
        th {
            background-color: #343a40;
            color: white;
        }
        
        .total-row {
            font-weight: bold;
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container-fluid py-4">
        <div class="receipt-header">
            <h1 class="mb-2">
                <i class="bi bi-receipt-cutoff me-2"></i>Receipt Report
            </h1>
            <h5 class="text-muted">
                @ViewBag.StartDate.ToString("MMMM d, yyyy") - @ViewBag.EndDate.ToString("MMMM d, yyyy")
            </h5>
        </div>

        <div class="summary-box">
            <div class="row">
                <div class="col-md-4">
                    <strong>Total Receipts:</strong> @Model.Count()
                </div>
                <div class="col-md-4">
                    <strong>Date Range:</strong> @((ViewBag.EndDate - ViewBag.StartDate).Days + 1) days
                </div>
                <div class="col-md-4">
                    <strong>Total Amount:</strong> <span class="text-success">$@ViewBag.TotalAmount.ToString("N2")</span>
                </div>
            </div>
        </div>

        <div class="no-print mb-3 text-end">
            <button onclick="window.print()" class="btn btn-primary">
                <i class="bi bi-printer me-1"></i>Print
            </button>
            <button onclick="window.close()" class="btn btn-secondary">
                <i class="bi bi-x-circle me-1"></i>Close
            </button>
        </div>

        @if (Model.Any())
        {
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Vendor</th>
                        <th>Receipt #</th>
                        <th>Category</th>
                        <th>Payment Method</th>
                        <th class="text-end">Amount</th>
                        <th>Notes</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var receipt in Model)
                    {
                        <tr>
                            <td>@receipt.PurchaseDate.ToString("MM/dd/yyyy")</td>
                            <td><strong>@receipt.Vendor</strong></td>
                            <td>@(receipt.ReceiptNumber ?? "-")</td>
                            <td>@receipt.Category</td>
                            <td>
                                @receipt.PaymentMethod
                                @if (!string.IsNullOrEmpty(receipt.CardLastFour))
                                {
                                    <br><small>****@receipt.CardLastFour</small>
                                }
                            </td>
                            <td class="text-end">$@receipt.TotalAmount.ToString("N2")</td>
                            <td>@(receipt.Notes ?? "-")</td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr class="total-row">
                        <td colspan="5" class="text-end"><strong>TOTAL:</strong></td>
                        <td class="text-end"><strong>$@Model.Sum(r => r.TotalAmount).ToString("N2")</strong></td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>

            <div class="mt-4">
                <h6>Category Breakdown:</h6>
                <table class="table table-sm">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th class="text-end">Count</th>
                            <th class="text-end">Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var group in Model.GroupBy(r => r.Category).OrderByDescending(g => g.Sum(r => r.TotalAmount)))
                        {
                            <tr>
                                <td>@group.Key</td>
                                <td class="text-end">@group.Count()</td>
                                <td class="text-end">$@group.Sum(r => r.TotalAmount).ToString("N2")</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        }
        else
        {
            <div class="alert alert-info text-center">
                <i class="bi bi-inbox fs-1 d-block mb-3"></i>
                <h4>No receipts found for this date range</h4>
            </div>
        }

        <div class="text-center text-muted mt-5">
            <small>Generated on @DateTime.Now.ToString("MMMM d, yyyy 'at' h:mm tt")</small>
        </div>
    </div>
</body>
</html>
